#!/usr/bin/env node

const child_process = require('child_process');
const fs = require('fs');
const path = require('path');

const addonVersionFileName = path.join(__dirname, '..', 'src', 'version.h');

const version = process.env.npm_package_version;
const versions = version.split(/[.-]/);
const major = versions[0];
const minor = versions[1];
const patch = versions[2];

const addonVersionFileContent = `// This file is autogenerated
#ifndef __VERSION_H__
#define __VERSION_H__

static const uint16_t AppVersionMajor = ${major};
static const uint16_t AppVersionMinor = ${minor};
static const uint16_t AppVersionPatch = ${patch};
static const char  AppVersion[] = "${version}";

#endif
`;

fs.writeFileSync(addonVersionFileName, addonVersionFileContent, 'utf-8');
child_process.execSync(`git add ${addonVersionFileName}`);
